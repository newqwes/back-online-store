{"version":3,"sources":["../../src/services/userService.js"],"names":["UserService","email","User","findOne","where","foundUser","toJSON","req","id","user","responseUserData","responseUserDataWithToken","body","userData","findByEmail","password","update","returning","plain","destroy"],"mappings":";;;;;;;AAAA;;AAOA;;AAEA;;;;;;;;;;;;;;IAEMA,W;;;;;;;;kGACcC,K;;;;;;;uBACQC,eAAKC,OAAL,CAAa;AAAEC,kBAAAA,KAAK,EAAE;AAAEH,oBAAAA,KAAK,EAALA;AAAF;AAAT,iBAAb,C;;;AAAlBI,gBAAAA,S;;qBAEFA,S;;;;;iDAAkBA,SAAS,CAACC,MAAV,E;;;;;;;;;;;;;;;;;;;+FAGVC,G;;;;;;;AAEJC,gBAAAA,E,GAAK,qBAAUD,GAAV,C;;uBAEQL,eAAKC,OAAL,CAAa;AAC9BC,kBAAAA,KAAK,EAAE;AAAEI,oBAAAA,EAAE,EAAFA;AAAF;AADuB,iBAAb,C;;;AAAbC,gBAAAA,I;AAIAC,gBAAAA,gB,GAAmB,kCAAuBD,IAAvB,C;AACnBE,gBAAAA,yB,GAA4B,gCAAqBD,gBAArB,C;kDAE3B,6BAAe,GAAf,EAAoB,eAApB,EAAqCC,yBAArC,C;;;;;kDAEA,6BAAe,GAAf,EAAoB,cAApB,e;;;;;;;;;;;;;;;;;;;8FAIEJ,G;;;;;;;;AAEDK,gBAAAA,I,GAASL,G,CAATK,I;AAEFJ,gBAAAA,E,GAAK,qBAAUD,GAAV,C;AAEPM,gBAAAA,Q,GAAW,0BAAeD,IAAf,C;4BAEGC,Q,EAAVZ,K,aAAAA,K;;qBAEJA,K;;;;;;uBACsB,KAAKa,WAAL,CAAiBb,KAAjB,C;;;AAAlBI,gBAAAA,S;;sBAEFA,SAAS,IAAIA,SAAS,CAACG,EAAV,KAAiBA,E;;;;;kDACzB,6BAAe,GAAf,EAAoB,uBAApB,C;;;AAIHO,gBAAAA,Q,GAAaH,I,CAAbG,Q;;AAER,oBAAIA,QAAJ,EAAc;AACZF,kBAAAA,QAAQ,GAAG,mCAAwBA,QAAxB,EAAkCE,QAAlC,CAAX;AACD;;;uBAEkBb,eAAKc,MAAL,CAAYH,QAAZ,EAAsB;AACvCT,kBAAAA,KAAK,EAAE;AAAEI,oBAAAA,EAAE,EAAFA;AAAF,mBADgC;AAEvCS,kBAAAA,SAAS,EAAE,IAF4B;AAGvCC,kBAAAA,KAAK,EAAE;AAHgC,iBAAtB,C;;;AAAbT,gBAAAA,I;AAMAC,gBAAAA,gB,GAAmB,kCAAuBD,IAAvB,C;AACnBE,gBAAAA,yB,GAA4B,gCAAqBD,gBAArB,C;kDAE3B,6BAAe,GAAf,EAAoB,eAApB,EAAqCC,yBAArC,C;;;;;kDAEA,6BAAe,GAAf,EAAoB,cAApB,e;;;;;;;;;;;;;;;;;;;+FAIEJ,G;;;;;;;AAEHC,gBAAAA,E,GAAK,qBAAUD,GAAV,C;;uBAELL,eAAKiB,OAAL,CAAa;AAAEf,kBAAAA,KAAK,EAAE;AAAEI,oBAAAA,EAAE,EAAFA;AAAF;AAAT,iBAAb,C;;;kDAEC,6BAAe,GAAf,EAAoB,eAApB,EAAqCA,EAArC,C;;;;;kDAEA,6BAAe,GAAf,EAAoB,cAApB,e;;;;;;;;;;;;;;;;;;;;;eAKE,IAAIR,WAAJ,E","sourcesContent":["import {\n  getUserId,\n  setUserDataWithToken,\n  setUserDataWithPassword,\n  createUserData,\n  createResponseUserData,\n} from '../utils/user';\nimport createResponse from '../utils/createResponse';\n\nimport User from '../database/models/user';\n\nclass UserService {\n  async findByEmail(email) {\n    const foundUser = await User.findOne({ where: { email } });\n\n    if (foundUser) return foundUser.toJSON();\n  }\n\n  async getInfo(req) {\n    try {\n      const id = getUserId(req);\n\n      const user = await User.findOne({\n        where: { id },\n      });\n\n      const responseUserData = createResponseUserData(user);\n      const responseUserDataWithToken = setUserDataWithToken(responseUserData);\n\n      return createResponse(200, 'Successfully!', responseUserDataWithToken);\n    } catch (error) {\n      return createResponse(500, 'Server Error', error);\n    }\n  }\n\n  async update(req) {\n    try {\n      const { body } = req;\n\n      const id = getUserId(req);\n\n      let userData = createUserData(body);\n\n      const { email } = userData;\n\n      if (email) {\n        const foundUser = await this.findByEmail(email);\n\n        if (foundUser && foundUser.id !== id) {\n          return createResponse(409, 'email already exists!');\n        }\n      }\n\n      const { password } = body;\n\n      if (password) {\n        userData = setUserDataWithPassword(userData, password);\n      }\n\n      const user = await User.update(userData, {\n        where: { id },\n        returning: true,\n        plain: true,\n      });\n\n      const responseUserData = createResponseUserData(user);\n      const responseUserDataWithToken = setUserDataWithToken(responseUserData);\n\n      return createResponse(200, 'Successfully!', responseUserDataWithToken);\n    } catch (error) {\n      return createResponse(500, 'Server Error', error);\n    }\n  }\n\n  async delete(req) {\n    try {\n      const id = getUserId(req);\n\n      await User.destroy({ where: { id } });\n\n      return createResponse(200, 'Successfully!', id);\n    } catch (error) {\n      return createResponse(500, 'Server Error', error);\n    }\n  }\n}\n\nexport default new UserService();\n"],"file":"userService.js"}