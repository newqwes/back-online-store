{"version":3,"sources":["../../src/middleware/checkRole.js"],"names":["GUEST_ROLE","process","env","checkRole","roles","req","res","next","passport","authenticate","session","err","user","status","send","includes","type"],"mappings":";;;;;;;AAAA;;;;IAEQA,U,GAAeC,OAAO,CAACC,G,CAAvBF,U;;AAER,IAAMG,SAAS,GAAG,SAAZA,SAAY,CAAAC,KAAK;AAAA,SAAI,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC7CC,sBAASC,YAAT,CAAsB,KAAtB,EAA6B;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAA7B,EAAiD,UAACC,GAAD,EAAMC,IAAN,EAAe;AAC9D,UAAID,GAAJ,EAAS;AACPL,QAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,0BAArB;AAEA;AACD;;AAED,UAAIV,KAAK,CAACW,QAAN,CAAef,UAAf,KAA8B,CAACY,IAAnC,EAAyC;AACvCL,QAAAA,IAAI;AAEJ;AACD;;AAED,UAAIH,KAAK,CAACW,QAAN,CAAeH,IAAI,CAACI,IAApB,CAAJ,EAA+B;AAC7BX,QAAAA,GAAG,CAACO,IAAJ,GAAWA,IAAX;AACAL,QAAAA,IAAI;AAEJ;AACD;;AAEDD,MAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,0BAArB;AACD,KArBD,EAqBGT,GArBH,EAqBQC,GArBR,EAqBaC,IArBb;AAsBD,GAvBsB;AAAA,CAAvB;;eAyBeJ,S","sourcesContent":["import passport from 'passport';\n\nconst { GUEST_ROLE } = process.env;\n\nconst checkRole = roles => (req, res, next) => {\n  passport.authenticate('jwt', { session: false }, (err, user) => {\n    if (err) {\n      res.status(403).send('Not authorized to access');\n\n      return;\n    }\n\n    if (roles.includes(GUEST_ROLE) && !user) {\n      next();\n\n      return;\n    }\n\n    if (roles.includes(user.type)) {\n      req.user = user;\n      next();\n\n      return;\n    }\n\n    res.status(403).send('Not authorized to access');\n  })(req, res, next);\n};\n\nexport default checkRole;\n"],"file":"checkRole.js"}